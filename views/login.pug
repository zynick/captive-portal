//- http://wiki.mikrotik.com/wiki/HotSpot_external_login_page

extends layout

block content
    .content-wrapper-inner
        a(href=assets.url)
            img#logo(src=assets.logo)
        p#slogan=assets.slogan

        br

        if data.message
            p#message=data.message
        if data.error
            p#error=data.error

        if login.email
            form#login-form(name='form', method='POST', action=data['link-login-only'], onSubmit='return encryptPass()')
                .form-group
                    input.form-control(type='text', name='username', value=data.username, placeholder='Email')
                .form-group
                    input.form-control(type='password', name='password', placeholder='Password')
                .form-group
                    input.form-control.btn.btn-primary(name='submit', type='submit', value='LOGIN')
                .form-group
                    a(href=login.signupUrl) SIGN UP

        if login.guestEnabled
            //- TODO not fucking work!!!!!
            //- TODO not fucking work!!!!!
            //- TODO not fucking work!!!!!
            //- TODO not fucking work!!!!!
            //- TODO not fucking work!!!!!
            //- TODO not fucking work!!!!!
            //- TODO not fucking work!!!!!
            //- TODO not fucking work!!!!!
            //- TODO not fucking work!!!!!
            //- TODO not fucking work!!!!!
            //- TODO not fucking work!!!!!
            //- TODO not fucking work!!!!!
            //- TODO not fucking work!!!!!
            //- TODO not fucking work!!!!!
            //- TODO not fucking work!!!!!
            //- TODO not fucking work!!!!!
            //- TODO not fucking work!!!!!
            //- TODO not fucking work!!!!!
            //- TODO where will it redirect to if no dst is set?
            a(href='#{data["link-login-only"]}?username=T-#{data["mac"]}') LOGIN AS GUEST

append script
    if login.email
        if data['chap-challenge']
            script(src='/js/md5.js')
            script(type='text/javascript').
                function encryptPass() {
                    document.form.password.value = md5('#{data["chap-id"]}' + document.form.password.value + '#{data["chap-challenge"]}');
                    return true;
                }
        else
            script(type='text/javascript').
                function encryptPass() { return true; }