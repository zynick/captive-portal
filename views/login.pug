extends layout

block content
    //- http://wiki.mikrotik.com/wiki/HotSpot_external_login_page
    .content-wrapper-inner
        a(href=assets.url)
            img#logo(src=assets.logo)
        p#slogan=assets.slogan

        br

        if data.message
            p#message=data.message
        if data.error
            p#error=data.error

        if login.email
            form(name='loginForm', method='POST', action=data['link-login-only'], onSubmit='hash(); return false;')
                .form-group
                    input.form-control(type='text', name='username', value=data.username, placeholder='Email')
                .form-group
                    input.form-control(type='password', name='password', placeholder='Password')
                .form-group
                    input.form-control.btn.btn-primary(type='submit', value='LOGIN')
                .form-group
                    br
                    a(href=login.signupUrl) SIGN UP
        if login.guestEnabled
            a(href=`${data["link-login-only"]}?username=T-${data["mac"]}`) LOGIN AS GUEST

append script
    if login.email
        script(src='/js/argon2.js')
        script(type='text/javascript').
            function hash() {
                let username = document.loginForm.username.value;
                let password = document.loginForm.password.value;
                argon2
                    .hash({
                        pass: password,
                        salt: username + 'ace-tide',
                        time: 3,
                        mem: 2048,
                        hashLen: 32,
                        parallelism: 1,
                        type: argon2.ArgonType.Argon2d,
                        distPath: '/js'
                    })
                    .then(submit)
                    .catch(e => alert(e.message + e.code))
            }

        if data['chap-challenge']
            script(src='/js/md5.js')
            script(type='text/javascript').
                function submit(hash) {
                    document.loginForm.password.value = md5('#{data["chap-id"]}' + hash.hashHex + '#{data["chap-challenge"]}');
                    document.loginForm.submit();
                }
        else
            script(type='text/javascript').
                function submit(hash) {
                    document.loginForm.password.value = hash.hashHex;
                    document.loginForm.submit();
                }